
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.11">
    
    
      
        <title>docker_notes - Sugar的个人博客</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8c5ef100.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.9647289d.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-docker" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Sugar的个人博客" class="md-header__button md-logo" aria-label="Sugar的个人博客" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Sugar的个人博客
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              docker_notes
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Sugar的个人博客" class="md-nav__button md-logo" aria-label="Sugar的个人博客" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Sugar的个人博客
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          IC设计
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="IC设计" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          IC设计
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../digital-circuit/jpeg_decoder/" class="md-nav__link">
        JPEG_decoder
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          bus
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="bus" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          bus
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../learn_bus/I2C/" class="md-nav__link">
        I2C
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          docker学习
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="docker学习" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          docker学习
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          docker_notes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        docker_notes
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-docker" class="md-nav__link">
    1. docker
  </a>
  
    <nav class="md-nav" aria-label="1. docker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-docker" class="md-nav__link">
    1.1. 启动docker
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-image" class="md-nav__link">
    2. image
  </a>
  
    <nav class="md-nav" aria-label="2. image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-docler-search" class="md-nav__link">
    2.1. docler search 搜索镜像
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-docker-pull" class="md-nav__link">
    2.2. docker pull 下载镜像
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-docker" class="md-nav__link">
    2.3. docker镜像原理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-image" class="md-nav__link">
    2.4. 生成自己的image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-container" class="md-nav__link">
    3. container
  </a>
  
    <nav class="md-nav" aria-label="3. container">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-docker" class="md-nav__link">
    3.1. docker 容器的存储位置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-docker-run" class="md-nav__link">
    3.2. docker run
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-docker-ps" class="md-nav__link">
    3.3. docker ps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    3.4. 退出容器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35" class="md-nav__link">
    3.5. 删除容器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36" class="md-nav__link">
    3.6. 启动停止容器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37" class="md-nav__link">
    3.7. 其他命令
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4. 实例
  </a>
  
    <nav class="md-nav" aria-label="4. 实例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-dockernginx" class="md-nav__link">
    4.1. docker安装nginx
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-dockertomcat" class="md-nav__link">
    4.2. docker安装tomcat
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-dockereskibana" class="md-nav__link">
    4.3. docker部署es+kibana
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5. 容器数据卷
  </a>
  
    <nav class="md-nav" aria-label="5. 容器数据卷">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    5.1. 容器数据卷挂载到主机
  </a>
  
    <nav class="md-nav" aria-label="5.1. 容器数据卷挂载到主机">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#511-1-v" class="md-nav__link">
    5.1.1. 方式1. 启动容器时, 使用命令来挂载 -v
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512-2-dockerfile" class="md-nav__link">
    5.1.2. 方式2. 通过dockerfile进行挂载
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52" class="md-nav__link">
    5.2. 多容器互相挂载
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53" class="md-nav__link">
    5.3. 具名挂载和匿名挂载
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-dockerfile" class="md-nav__link">
    6. dockerfile
  </a>
  
    <nav class="md-nav" aria-label="6. dockerfile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61" class="md-nav__link">
    6.1. 构建步骤:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62" class="md-nav__link">
    6.2. 查看官方例子
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-dockerfile" class="md-nav__link">
    6.3. dockerfile组成
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64-dockerfile" class="md-nav__link">
    6.4. dockerfile的指令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#65-dockerfilecentos" class="md-nav__link">
    6.5. 使用dockerfile构建自己的centos系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#66" class="md-nav__link">
    6.6. 列出镜像历史
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#67-cmdentrypoint" class="md-nav__link">
    6.7. CMD和ENTRYPOINT的区别
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-reference" class="md-nav__link">
    7. reference
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../docker%E6%90%AD%E5%BB%BA%E6%80%9D%E6%BA%90%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        docker实战:思源笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../docsify%E6%90%AD%E5%BB%BA%E8%AE%B0%E5%BD%95/" class="md-nav__link">
        docker实战:docsify
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          CS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="CS" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          CS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web_tech/yuedu_web/" class="md-nav__link">
        阅读
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-docker" class="md-nav__link">
    1. docker
  </a>
  
    <nav class="md-nav" aria-label="1. docker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-docker" class="md-nav__link">
    1.1. 启动docker
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-image" class="md-nav__link">
    2. image
  </a>
  
    <nav class="md-nav" aria-label="2. image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-docler-search" class="md-nav__link">
    2.1. docler search 搜索镜像
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-docker-pull" class="md-nav__link">
    2.2. docker pull 下载镜像
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-docker" class="md-nav__link">
    2.3. docker镜像原理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-image" class="md-nav__link">
    2.4. 生成自己的image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-container" class="md-nav__link">
    3. container
  </a>
  
    <nav class="md-nav" aria-label="3. container">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-docker" class="md-nav__link">
    3.1. docker 容器的存储位置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-docker-run" class="md-nav__link">
    3.2. docker run
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-docker-ps" class="md-nav__link">
    3.3. docker ps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    3.4. 退出容器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35" class="md-nav__link">
    3.5. 删除容器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36" class="md-nav__link">
    3.6. 启动停止容器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37" class="md-nav__link">
    3.7. 其他命令
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4. 实例
  </a>
  
    <nav class="md-nav" aria-label="4. 实例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-dockernginx" class="md-nav__link">
    4.1. docker安装nginx
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-dockertomcat" class="md-nav__link">
    4.2. docker安装tomcat
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-dockereskibana" class="md-nav__link">
    4.3. docker部署es+kibana
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5. 容器数据卷
  </a>
  
    <nav class="md-nav" aria-label="5. 容器数据卷">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    5.1. 容器数据卷挂载到主机
  </a>
  
    <nav class="md-nav" aria-label="5.1. 容器数据卷挂载到主机">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#511-1-v" class="md-nav__link">
    5.1.1. 方式1. 启动容器时, 使用命令来挂载 -v
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512-2-dockerfile" class="md-nav__link">
    5.1.2. 方式2. 通过dockerfile进行挂载
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52" class="md-nav__link">
    5.2. 多容器互相挂载
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53" class="md-nav__link">
    5.3. 具名挂载和匿名挂载
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-dockerfile" class="md-nav__link">
    6. dockerfile
  </a>
  
    <nav class="md-nav" aria-label="6. dockerfile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61" class="md-nav__link">
    6.1. 构建步骤:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62" class="md-nav__link">
    6.2. 查看官方例子
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-dockerfile" class="md-nav__link">
    6.3. dockerfile组成
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64-dockerfile" class="md-nav__link">
    6.4. dockerfile的指令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#65-dockerfilecentos" class="md-nav__link">
    6.5. 使用dockerfile构建自己的centos系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#66" class="md-nav__link">
    6.6. 列出镜像历史
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#67-cmdentrypoint" class="md-nav__link">
    6.7. CMD和ENTRYPOINT的区别
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-reference" class="md-nav__link">
    7. reference
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


  <h1>docker_notes</h1>

<blockquote>
<p>作者: sugar</p>
<p>转载请联系作者(1144392179@qq.com),并说明出处!</p>
</blockquote>
<h2 id="1-docker">1. docker</h2>
<h3 id="11-docker">1.1. 启动docker</h3>
<p>docker是服务器-客户端架构, 因此, 如果需要使用<code>docker</code>命令, 需要本机启动<code>docker</code>服务:</p>
<pre><code class="language-bash">systemctl start docker #systemctl用法
service docker start  #service用法
</code></pre>
<p>由于docker的启动需要sudo权限, 为了避免每次使用都输入sudo, 可以将用户加入docker用户组</p>
<pre><code class="language-bash">sudo usermode -aG docker $USER
</code></pre>
<h2 id="2-image">2. image</h2>
<p>Docker 把应用程序及其依赖，打包在 image 文件里面。只有通过这个文件，才能生成 Docker 容器。image 文件可以看作是容器的模板。Docker 根据 image 文件生成容器的实例。同一个 image 文件，可以生成多个同时运行的容器实例。</p>
<p>相关命令:[^3][^1]</p>
<pre><code class="language-bash">#列出本机的所有image
docker imags
docker images -aq
# 参数
-a, --all # 列出所有镜像
-q, --quiet # 只显示镜像的ID

# 删除image
docker image rm [imageName]
docker rmi -f [imageID]

# 删除所有的images
docker rmi -f $(docker images -aq)
</code></pre>
<pre><code class="language-shell">[root@sugarlearn ~]# docker images
REPOSITORY                TAG                 IMAGE ID            CREATED             SIZE
docker.io/b3log/siyuan    latest              a35a2a94fc5b        16 hours ago        142 MB
docker.io/zmister/mrdoc   v1                  1f0e4ae2440e        12 days ago         839 MB

#解释：
- REPOSITORY  仓库源
- TAG         镜像的标签
- IMAGE ID    镜像的ID
- CREATED     镜像创建的时间
- SIZE        镜像的大小


</code></pre>
<h3 id="21-docler-search">2.1. docler search 搜索镜像</h3>
<pre><code class="language-bash">docker search [imageName]
</code></pre>
<pre><code class="language-shell">[root@sugarlearn ~]# docker search siyuan
INDEX       NAME                                           DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
docker.io   docker.io/b3log/siyuan                         思源笔记 Docker 镜像。SiYuan Docker Image.             27
docker.io   docker.io/siyuanhuang95/livox_slam             This docker offers you a convenient develo...   3
docker.io   docker.io/hhxsy/siyuan_xie                     myRepository                                    0
docker.io   docker.io/lsy643/lsy643                        Docker images from Siyuan Li                    0
docker.io   docker.io/nn200433/siyuan                      基于 b3log/siyuan ，删除默认siyuan用户                   0
docker.io   docker.io/siyuan0/learning                                                                     0
docker.io   docker.io/siyuan0/pytorch_chensy                                                               0
docker.io   docker.io/siyuan0322/hello                     hello world project of docker                   0
docker.io   docker.io/siyuan0322/mpi                                                                       0
docker.io   docker.io/siyuan0322/sshd                                                                      0
docker.io   docker.io/siyuan89/app01                                                                       0
docker.io   docker.io/siyuanchen726/docker101tutorial                                                      0
docker.io   docker.io/siyuangao/cni_challenge                                                              0
docker.io   docker.io/siyuangao/cni_challenge_dockerrepo                                                   0
docker.io   docker.io/siyuanli/cs503_tensorflow_jupyter                                                    0
docker.io   docker.io/siyuanli/onlinejudge                                                                 0
docker.io   docker.io/siyuanwlw/cheers2019                                                                 0
docker.io   docker.io/siyuanzhang0519/cheers2019                                                           0
docker.io   docker.io/siyuanzhu/friendlyhello                                                              0
docker.io   docker.io/siyuanzhu/toy-flask                                                                  0
docker.io   docker.io/taosiyuan/influxdb                   Created by siyuan.tao on 2017-3-22              0
docker.io   docker.io/xbdz/siyuan                          思源笔记镜像                                          0
</code></pre>
<h3 id="22-docker-pull">2.2. docker pull 下载镜像</h3>
<pre><code class="language-bash">[root@sugarlearn ~]# docker pull jonnyan404/mrdoc
Using default tag: latest   # 默认下载最新版本，如果不加tag 就下载默认的最新版
Trying to pull repository docker.io/jonnyan404/mrdoc ...
latest: Pulling from docker.io/jonnyan404/mrdoc
59bf1c3509f3: Already exists   # 分层下载，已存在的层，就无需重新下载，联合文件系统思想
8786870f2876: Pull complete
45d4696938d0: Pull complete
ef84af58b2c5: Pull complete
c3c9b71b9a69: Pull complete
2f08af9381b7: Pull complete
7c154285520e: Pull complete
ab0cf852a137: Pull complete
Digest: sha256:dcb21f432b0ba6fb44284b0efe195a3701fda2a91c7c182b05d5fbfad632e328  # 签名
Status: Downloaded newer image for docker.io/jonnyan404/mrdoc:latest    # 真实地址
</code></pre>
<p>指定版本进行下载</p>
<pre><code class="language-bash">docker pull jonnyan404/mrdoc:&lt;version&gt;
</code></pre>
<h3 id="23-docker">2.3. docker镜像原理</h3>
<h3 id="24-image">2.4. 生成自己的image</h3>
<p>[[#5 dockerfile]]</p>
<h2 id="3-container">3. container</h2>
<blockquote>
<p>有了镜像才可以创建容器</p>
</blockquote>
<h3 id="31-docker">3.1. docker 容器的存储位置</h3>
<p>docker相关的所有数据都保存在主机的这个目录:<code>/var/lib/docker/</code>
创建的容器, 下载的镜像等等</p>
<h3 id="32-docker-run">3.2. docker run</h3>
<pre><code class="language-bash">docker run [可选参数] image

# 参数说明
-name=&quot;Name&quot;   容器名字, image1 image2用来区分容器
-d             后台运行
-it            交互式运行容器
-p             指定容器端口
    -p 主机端口:容器端口(常用)
    -p 容器端口
-P             随机指定端口
</code></pre>
<h3 id="33-docker-ps">3.3. docker ps</h3>
<pre><code class="language-bash">docker ps # 列出正在运行的容器
docker ps -q # 只列出ID

</code></pre>
<h3 id="34">3.4. 退出容器</h3>
<pre><code class="language-bash">exit # 停止运行, 退出容器
ctrl + P + Q # 退出不停止
</code></pre>
<h3 id="35">3.5. 删除容器</h3>
<pre><code class="language-bash">docker rm ID
docker rm -f $(docker ps -q)
docker ps -aq | xargs docker rm
</code></pre>
<h3 id="36">3.6. 启动停止容器</h3>
<pre><code class="language-bash">docker start 容器ID # 启动容器
docker restat ID   #重启容器
docker stop ID     #停止容器
docker kill ID     #强制停止
</code></pre>
<h3 id="37">3.7. 其他命令</h3>
<pre><code class="language-bash">[root@sugarlearn ~]# docker run -d centos
ca6b8a3a36e6b175e1bbbea8106a2365f5f410827a3e27687d61da510b2ae662
[root@sugarlearn ~]# docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES

# 问题: 后台启动centos镜像, docker并没有启动

docker使用后台运行, 就必须有一个前台进程, docker发现没有应用,就会自动停止
</code></pre>
<pre><code class="language-bash"># 查看日志
[root@sugarlearn ~]# docker logs --help

Usage:  docker logs [OPTIONS] CONTAINER

Fetch the logs of a container

Options:
      --details        Show extra details provided to logs
  -f, --follow         Follow log output
      --help           Print usage
      --since string   Show logs since timestamp
      --tail string    Number of lines to show from the end of the logs (default &quot;all&quot;)
  -t, --timestamps     Show timestamps



# 写一个持续运行的脚本,放入后台运行, 使用log打印日志
[root@sugarlearn ~]# docker run -d centos /bin/bash -c &quot;while true; do echo sugar; sleep 1; done&quot;
2a780fc5f68cd62e0d0a99ece3bb4401283066587276e45de41de8c7498cb57f
[root@sugarlearn ~]# docker logs -ft --tail 10 2a780fc5f68cd62e0d0a99ece3bb4401283066587276e45de41de8c7498cb57f
2022-01-19T19:09:02.938158000Z sugar
2022-01-19T19:09:03.941165000Z sugar
2022-01-19T19:09:04.944188000Z sugar
2022-01-19T19:09:05.947294000Z sugar
2022-01-19T19:09:06.950443000Z sugar
2022-01-19T19:09:07.953860000Z sugar
2022-01-19T19:09:08.957836000Z sugar
2022-01-19T19:09:09.961211000Z sugar
2022-01-19T19:09:10.963906000Z sugar
2022-01-19T19:09:11.967134000Z sugar
2022-01-19T19:09:12.971447000Z sugar
2022-01-19T19:09:13.974090000Z sugar
</code></pre>
<pre><code class="language-bash"># 查看容器的进程信息
docker top ID 
</code></pre>
<pre><code class="language-bash"># 查看容器元数据
docker inspect

[root@sugarlearn ~]# docker inspect 2a780fc5f68cd62e0d0a99ece3bb4401283066587276e45de41de8c7498cb57f
[
    {
        &quot;Id&quot;: &quot;2a780fc5f68cd62e0d0a99ece3bb4401283066587276e45de41de8c7498cb57f&quot;,
        &quot;Created&quot;: &quot;2022-01-19T19:08:56.65117041Z&quot;,
        &quot;Path&quot;: &quot;/bin/bash&quot;,
        &quot;Args&quot;: [
            &quot;-c&quot;,
            &quot;while true; do echo sugar; sleep 1; done&quot;
        ],
        &quot;State&quot;: {
            &quot;Status&quot;: &quot;running&quot;,
            &quot;Running&quot;: true,
            &quot;Paused&quot;: false,
            &quot;Restarting&quot;: false,
            &quot;OOMKilled&quot;: false,
            &quot;Dead&quot;: false,
            &quot;Pid&quot;: 3374,
            &quot;ExitCode&quot;: 0,
            &quot;Error&quot;: &quot;&quot;,
            &quot;StartedAt&quot;: &quot;2022-01-19T19:08:56.91832488Z&quot;,
            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;
        },
        &quot;Image&quot;: &quot;sha256:5d0da3dc976460b72c77d94c8a1ad043720b0416bfc16c52c45d4847e53fadb6&quot;,
        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/2a780fc5f68cd62e0d0a99ece3bb4401283066587276e45de41de8c7498cb57f/resolv.conf&quot;,
        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/2a780fc5f68cd62e0d0a99ece3bb4401283066587276e45de41de8c7498cb57f/hostname&quot;,
        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/2a780fc5f68cd62e0d0a99ece3bb4401283066587276e45de41de8c7498cb57f/hosts&quot;,
        &quot;LogPath&quot;: &quot;&quot;,
        &quot;Name&quot;: &quot;/festive_euler&quot;,
        &quot;RestartCount&quot;: 0,
        &quot;Driver&quot;: &quot;overlay2&quot;,
        &quot;MountLabel&quot;: &quot;&quot;,
        &quot;ProcessLabel&quot;: &quot;&quot;,
        &quot;AppArmorProfile&quot;: &quot;&quot;,
        &quot;ExecIDs&quot;: null,
        &quot;HostConfig&quot;: {
            &quot;Binds&quot;: null,
            &quot;ContainerIDFile&quot;: &quot;&quot;,
            &quot;LogConfig&quot;: {
                &quot;Type&quot;: &quot;journald&quot;,
                &quot;Config&quot;: {}
            },
            &quot;NetworkMode&quot;: &quot;default&quot;,
            &quot;PortBindings&quot;: {},
            &quot;RestartPolicy&quot;: {
                &quot;Name&quot;: &quot;no&quot;,
                &quot;MaximumRetryCount&quot;: 0
            },
            &quot;AutoRemove&quot;: false,
            &quot;VolumeDriver&quot;: &quot;&quot;,
            &quot;VolumesFrom&quot;: null,
            &quot;CapAdd&quot;: null,
            &quot;CapDrop&quot;: null,
            &quot;Dns&quot;: [],
            &quot;DnsOptions&quot;: [],
            &quot;DnsSearch&quot;: [],
            &quot;ExtraHosts&quot;: null,
            &quot;GroupAdd&quot;: null,
            &quot;IpcMode&quot;: &quot;&quot;,
            &quot;Cgroup&quot;: &quot;&quot;,
            &quot;Links&quot;: null,
            &quot;OomScoreAdj&quot;: 0,
            &quot;PidMode&quot;: &quot;&quot;,
            &quot;Privileged&quot;: false,
            &quot;PublishAllPorts&quot;: false,
            &quot;ReadonlyRootfs&quot;: false,
            &quot;SecurityOpt&quot;: null,
            &quot;UTSMode&quot;: &quot;&quot;,
            &quot;UsernsMode&quot;: &quot;&quot;,
            &quot;ShmSize&quot;: 67108864,
            &quot;Runtime&quot;: &quot;docker-runc&quot;,
            &quot;ConsoleSize&quot;: [
                0,
                0
            ],
            &quot;Isolation&quot;: &quot;&quot;,
            &quot;CpuShares&quot;: 0,
            &quot;Memory&quot;: 0,
            &quot;NanoCpus&quot;: 0,
            &quot;CgroupParent&quot;: &quot;&quot;,
            &quot;BlkioWeight&quot;: 0,
            &quot;BlkioWeightDevice&quot;: null,
            &quot;BlkioDeviceReadBps&quot;: null,
            &quot;BlkioDeviceWriteBps&quot;: null,
            &quot;BlkioDeviceReadIOps&quot;: null,
            &quot;BlkioDeviceWriteIOps&quot;: null,
            &quot;CpuPeriod&quot;: 0,
            &quot;CpuQuota&quot;: 0,
            &quot;CpuRealtimePeriod&quot;: 0,
            &quot;CpuRealtimeRuntime&quot;: 0,
            &quot;CpusetCpus&quot;: &quot;&quot;,
            &quot;CpusetMems&quot;: &quot;&quot;,
            &quot;Devices&quot;: [],
            &quot;DiskQuota&quot;: 0,
            &quot;KernelMemory&quot;: 0,
            &quot;MemoryReservation&quot;: 0,
            &quot;MemorySwap&quot;: 0,
            &quot;MemorySwappiness&quot;: -1,
            &quot;OomKillDisable&quot;: false,
            &quot;PidsLimit&quot;: 0,
            &quot;Ulimits&quot;: null,
            &quot;CpuCount&quot;: 0,
            &quot;CpuPercent&quot;: 0,
            &quot;IOMaximumIOps&quot;: 0,
            &quot;IOMaximumBandwidth&quot;: 0
        },
        &quot;GraphDriver&quot;: {
            &quot;Name&quot;: &quot;overlay2&quot;,
            &quot;Data&quot;: {
                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/619adce5a0d2a1b8745d4f3935c9b1dc6c30c4494e46ce32e68cfaccb80b2853-init/diff:/var/lib/docker/overlay2/34e966a6c48160e1928a33a3bf332e2da80f374b51dbe603cf98e64d4b379fa2/diff&quot;,
                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/619adce5a0d2a1b8745d4f3935c9b1dc6c30c4494e46ce32e68cfaccb80b2853/merged&quot;,
                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/619adce5a0d2a1b8745d4f3935c9b1dc6c30c4494e46ce32e68cfaccb80b2853/diff&quot;,
                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/619adce5a0d2a1b8745d4f3935c9b1dc6c30c4494e46ce32e68cfaccb80b2853/work&quot;
            }
        },
        &quot;Mounts&quot;: [],
        &quot;Config&quot;: {
            &quot;Hostname&quot;: &quot;2a780fc5f68c&quot;,
            &quot;Domainname&quot;: &quot;&quot;,
            &quot;User&quot;: &quot;&quot;,
            &quot;AttachStdin&quot;: false,
            &quot;AttachStdout&quot;: false,
            &quot;AttachStderr&quot;: false,
            &quot;Tty&quot;: false,
            &quot;OpenStdin&quot;: false,
            &quot;StdinOnce&quot;: false,
            &quot;Env&quot;: [
                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;
            ],
            &quot;Cmd&quot;: [
                &quot;/bin/bash&quot;,
                &quot;-c&quot;,
                &quot;while true; do echo sugar; sleep 1; done&quot;
            ],
            &quot;Image&quot;: &quot;centos&quot;,
            &quot;Volumes&quot;: null,
            &quot;WorkingDir&quot;: &quot;&quot;,
            &quot;Entrypoint&quot;: null,
            &quot;OnBuild&quot;: null,
            &quot;Labels&quot;: {
                &quot;org.label-schema.build-date&quot;: &quot;20210915&quot;,
                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,
                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,
                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,
                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;
            }
        },
        &quot;NetworkSettings&quot;: {
            &quot;Bridge&quot;: &quot;&quot;,
            &quot;SandboxID&quot;: &quot;fc0b45deead7c901e02710a67c6290a197e19d77d8e32266211c617d899c329a&quot;,
            &quot;HairpinMode&quot;: false,
            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,
            &quot;LinkLocalIPv6PrefixLen&quot;: 0,
            &quot;Ports&quot;: {},
            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/fc0b45deead7&quot;,
            &quot;SecondaryIPAddresses&quot;: null,
            &quot;SecondaryIPv6Addresses&quot;: null,
            &quot;EndpointID&quot;: &quot;da3db9f9ccbbbeb563c2aadfbb8938503cf9b2c82920893e9519a6365ccc3e51&quot;,
            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,
            &quot;GlobalIPv6Address&quot;: &quot;&quot;,
            &quot;GlobalIPv6PrefixLen&quot;: 0,
            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,
            &quot;IPPrefixLen&quot;: 16,
            &quot;IPv6Gateway&quot;: &quot;&quot;,
            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,
            &quot;Networks&quot;: {
                &quot;bridge&quot;: {
                    &quot;IPAMConfig&quot;: null,
                    &quot;Links&quot;: null,
                    &quot;Aliases&quot;: null,
                    &quot;NetworkID&quot;: &quot;b0fba45bae2a26e0e2c33eb5cf9050d48159091e9410d031cd83721db0fe436b&quot;,
                    &quot;EndpointID&quot;: &quot;da3db9f9ccbbbeb563c2aadfbb8938503cf9b2c82920893e9519a6365ccc3e51&quot;,
                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,
                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,
                    &quot;IPPrefixLen&quot;: 16,
                    &quot;IPv6Gateway&quot;: &quot;&quot;,
                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,
                    &quot;GlobalIPv6PrefixLen&quot;: 0,
                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;
                }
            }
        }
    }
]


</code></pre>
<pre><code class="language-bash"># 进入正在运行的容器
# 通常都是使用后台运行的容器, 需要进入后台运行的容器, 修改一些配置


# method 1: 进入容器, 开启新的终端, 可以在里面操作
docker exec -it containerID 


# method 2: 进入正在执行的终端,不会启动新的进程
docker attach containerID

[root@sugarlearn ~]# docker attach 2a780fc5f68c
sugar
sugar
sugar
sugar
sugar
sugar
sugar
sugar
</code></pre>
<pre><code class="language-bash"># 从容器拷贝文件出来
docker cp containerID:path host_path

</code></pre>
<pre><code class="language-bash"># 启动并进入容器,主机名就是ID名
[root@sugarlearn ~]# docker run -it centos /bin/bash
[root@8ec75bda8fcd /]#
[root@8ec75bda8fcd /]# ls
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
</code></pre>
<h2 id="4">4. 实例</h2>
<h3 id="41-dockernginx">4.1. docker安装nginx</h3>
<pre><code class="language-bash">[root@sugarlearn ~]# docker run -d --name nginx01 -p 3344:80 nginx  # -p 主机端口:docker端口, 将docker的端口映射到主机. nginx的默认端口为80, 映射之后, 在主机的3344端口可以访问到容器的80端口
e87155516f5b0c2ea566543eab6f54108ceb997b0dd2e56b78605bf18e09c465
[root@sugarlearn ~]# docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES
e87155516f5b        nginx               &quot;/docker-entrypoin...&quot;   19 seconds ago      Up 19 seconds       0.0.0.0:3344-&gt;80/tcp   nginx01
[root@sugarlearn ~]# curl localhost:3344
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
&lt;p&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/p&gt;

&lt;p&gt;For online documentation and support please refer to
&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
Commercial support is available at
&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
[root@sugarlearn ~]#

</code></pre>
<h3 id="42-dockertomcat">4.2. docker安装tomcat</h3>
<pre><code class="language-bash">docker run -it --rm tomcat:9.0

# --rm表示用完即删, 停止容器之后,立即就删除容器. 


# 正常启动tomcat, 映射端口为3344
docker run -d -p 3344:8080 --name tomcat01 tomcat
# 进入容器
docker exrc -it tomcat01 /bin/bash
# 将webapp.dist里面的内容拷贝到webapps里面, 打开ip:3344即可访问成功, 如下图所示
</code></pre>
<p>![[Pasted image 20220120193434.png]]</p>
<h3 id="43-dockereskibana">4.3. docker部署es+kibana</h3>
<blockquote>
<p>es暴露的端口很多
es十分的耗内存
es的数据一般需要挂载出去, 放置到安全目录</p>
</blockquote>
<pre><code class="language-bash">docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:tag
# --net 网络设置

# 去掉网络环境设置, 使用7.6.2版本
docker run -d --name elasticsearch  -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.6.2
# 启动服务之后, 系统负载十分大,linux直接卡住了

# 使用 docker stats 查看cpu的状态
docker status

# 测试es是否成功

# 关闭es, 增加内存的限制
docker run -d --name elasticsearch  -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -eES_JAVA_OPTS=&quot;-Xms64m -Xmx512m&quot; elasticsearch:7.6.2
</code></pre>
<h2 id="5">5. 容器数据卷</h2>
<p>数据持久化, 不保存在容器中 
 卷技术: 目录的挂载, 将容器内的目录挂载到linux上面. 可以将容器的数据和linux对应路径进行同步.</p>
<blockquote>
<p>容器之间也可以进行数据共享</p>
</blockquote>
<p>挂载是将主机的路径挂载到容器内, 因此主机是 source. 容器是 destination</p>
<h3 id="51">5.1. 容器数据卷挂载到主机</h3>
<h4 id="511-1-v">5.1.1. 方式1. 启动容器时, 使用命令来挂载 -v</h4>
<pre><code class="language-bash">docker run -it -v 主机目录:容器内目录
</code></pre>
<pre><code class="language-bash"># 使用docker inspect 查看&quot;Mounts&quot;: [
    {
        &quot;Type&quot;: &quot;bind&quot;,
        &quot;Source&quot;: &quot;/home/ceshi&quot;, # 主机的地址
        &quot;Destination&quot;: &quot;/home&quot;,  # 容器的地址
        &quot;Mode&quot;: &quot;&quot;,
        &quot;RW&quot;: true,
        &quot;Propagation&quot;: &quot;rprivate&quot;
    }
],

</code></pre>
<p>没有权限处理办法: <code>docker run -it --privileged=true -v /home/ceshi:/home centos /bin/bash</code>. (该方法好像失效了, 可以在启动容器的时候, 指定以root用户启动, 就会有权限了. )</p>
<h4 id="512-2-dockerfile">5.1.2. 方式2. 通过dockerfile进行挂载</h4>
<p>dockerfile 就是用来构建docker镜像的构建文件. 是命令脚本</p>
<pre><code class="language-bash"># 创建dockerfile文件
# 文件内容如下
# 指定(大写) 参数
# 每个命令就是image的一层

FROM centos

VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]

CMD echo &quot;---end---&quot;
CMD /bin/bash
</code></pre>
<p>运行该脚本, 生成一个新的镜像:
通过<code>build</code>进行镜像的构建, <code>-t</code>表示<code>target</code>, 生成的镜像名和版本号为<code>shigang/centos:1.0</code>, 生成的路径<code>.</code>表示当前路径下</p>
<pre><code class="language-bash">docker build -f dockerfile -t shigang/cantos:1.0 .
</code></pre>
<p>运行生成的image, 查看是否挂载. 可以发现在根目录下已经有了volume01和volume02两个卷. 脚本中写的是匿名挂载方式. </p>
<pre><code class="language-bash">[root@sugarlearn docker-test-volume]# docker ps -a
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                      NAMES
82a6ceebcf8a        b3log/siyuan        &quot;/opt/siyuan/kerne...&quot;   4 hours ago         Up 4 hours          0.0.0.0:6806-&gt;6806/tcp     siyuan
04b9ad86bdb6        zmister/mrdoc:v1    &quot;sh docker_mrdoc.sh&quot;     24 hours ago        Up 24 hours         0.0.0.0:10086-&gt;10086/tcp   mrdoc
[root@sugarlearn docker-test-volume]# docker run -it 7b064e07c425 /bin/bash
[root@c1e73c7792a5 /]# ls -l
total 56
lrwxrwxrwx   1 root root    7 Nov  3  2020 bin -&gt; usr/bin
drwxr-xr-x   5 root root  360 Jan 20 19:53 dev
drwxr-xr-x   1 root root 4096 Jan 20 19:53 etc
drwxr-xr-x   2 root root 4096 Nov  3  2020 home
lrwxrwxrwx   1 root root    7 Nov  3  2020 lib -&gt; usr/lib
lrwxrwxrwx   1 root root    9 Nov  3  2020 lib64 -&gt; usr/lib64
drwx------   2 root root 4096 Sep 15 14:17 lost+found
drwxr-xr-x   2 root root 4096 Nov  3  2020 media
drwxr-xr-x   2 root root 4096 Nov  3  2020 mnt
drwxr-xr-x   2 root root 4096 Nov  3  2020 opt
dr-xr-xr-x 141 root root    0 Jan 20 19:53 proc
dr-xr-x---   2 root root 4096 Sep 15 14:17 root
drwxr-xr-x   1 root root 4096 Jan 20 19:53 run
lrwxrwxrwx   1 root root    8 Nov  3  2020 sbin -&gt; usr/sbin
drwxr-xr-x   2 root root 4096 Nov  3  2020 srv
dr-xr-xr-x  13 root root    0 Jan 19 07:39 sys
drwxrwxrwt   7 root root 4096 Sep 15 14:17 tmp
drwxr-xr-x  12 root root 4096 Sep 15 14:17 usr
drwxr-xr-x  20 root root 4096 Sep 15 14:17 var
drwxr-xr-x   2 root root 4096 Jan 20 19:53 volume01
drwxr-xr-x   2 root root 4096 Jan 20 19:53 volume02
</code></pre>
<p>通过<code>docker inspect ID</code> 查看容器信息, 可以发现信息已经同步. 可以在容器中volume01创建文件夹,, 之后再宿主机查看是否有对应的文件. </p>
<pre><code class="language-bash">&quot;Mounts&quot;: [
    {
        &quot;Type&quot;: &quot;volume&quot;,
        &quot;Name&quot;: &quot;a6255c3d8111e65ef8dc62e2d8f0b951899f0c6d36455276daf384c6fc41861a&quot;,
        &quot;Source&quot;: &quot;/var/lib/docker/volumes/a6255c3d8111e65ef8dc62e2d8f0b951899f0c6d36455276daf384c6fc41861a/_data&quot;,
        &quot;Destination&quot;: &quot;volume01&quot;,
        &quot;Driver&quot;: &quot;local&quot;,
        &quot;Mode&quot;: &quot;&quot;,
        &quot;RW&quot;: true,
        &quot;Propagation&quot;: &quot;&quot;
    },
    {
        &quot;Type&quot;: &quot;volume&quot;,
        &quot;Name&quot;: &quot;0ec9fb36ce7235343426da000088f63115d99e603206ee0f9af5dd1bac6b3f4a&quot;,
        &quot;Source&quot;: &quot;/var/lib/docker/volumes/0ec9fb36ce7235343426da000088f63115d99e603206ee0f9af5dd1bac6b3f4a/_data&quot;,
        &quot;Destination&quot;: &quot;volume02&quot;,
        &quot;Driver&quot;: &quot;local&quot;,
        &quot;Mode&quot;: &quot;&quot;,
        &quot;RW&quot;: true,
        &quot;Propagation&quot;: &quot;&quot;
    }
],

</code></pre>
<h3 id="52">5.2. 多容器互相挂载</h3>
<blockquote>
<p>多个容器之间同步数据, 使用 <code>--volimes-from</code> 表示从另一个docker容器中获取挂载目录</p>
</blockquote>
<p>通过启动三个容器测试学习</p>
<p>在[[#方式2 通过dockerfile进行挂载]]的时候, 使用dockerfile创建了自己的image, 使用我们自己创建的image为例, 进行多个容器的容器卷挂载测试</p>
<ol>
<li>
<p>启动第一个容器
    <code>bash
    # 需要注意的是, centos系统容器直接使用exit退出后, 由于没有前台应用, 会自动停止运行
    # 因此需要使用 ctrl + P + Q 退出容器
    [root@sugarlearn home]# docker run -it --name docker01 7b064e07c425
    [root@815381166fd9 /]# ls
    bin  etc   lib    lost+found  mnt  proc  run   srv  tmp  var       volume02
    dev  home  lib64  media       opt  root  sbin  sys  usr  volume01</code></p>
</li>
<li>
<p>启动第二个容器, 发现和第一个容器的挂载目录一样
    <code>bash
    [root@sugarlearn home]# docker run -it --name docker02 --volumes-from docker01 7b064e07c425
    [root@9b5b20dec559 /]# ls
    bin  etc   lib    lost+found  mnt  proc  run   srv  tmp  var       volume02
    dev  home  lib64  media       opt  root  sbin  sys  usr  volume01</code></p>
</li>
<li>
<p>在<code>docker01</code>中的<code>volume01</code>中添加文件, 查看<code>docker02</code>中是否出现. 实验结果发现, 两个容器的卷是互通的
    ```bash
    [root@9b5b20dec559 /]# cd volume01
    [root@9b5b20dec559 volume01]# ls
    [root@9b5b20dec559 volume01]# touch 123
    [root@9b5b20dec559 volume01]# touch 12345
    [root@9b5b20dec559 volume01]# ls
    123  12345
    [root@9b5b20dec559 volume01]# [root@sugarlearn home]#
    [root@sugarlearn home]#
    [root@sugarlearn home]# docker ps
    CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                      NAMES
    9b5b20dec559        7b064e07c425        "/bin/sh -c /bin/bash"   4 minutes ago       Up 4 minutes                                   docker02
    815381166fd9        7b064e07c425        "/bin/sh -c /bin/bash"   8 minutes ago       Up 8 minutes                                   docker01
    82a6ceebcf8a        b3log/siyuan        "/opt/siyuan/kerne..."   5 hours ago         Up 4 hours          0.0.0.0:6806-&gt;6806/tcp     siyuan
    04b9ad86bdb6        zmister/mrdoc:v1    "sh docker_mrdoc.sh"     24 hours ago        Up 24 hours         0.0.0.0:10086-&gt;10086/tcp   mrdoc
    [root@sugarlearn home]# docker attach 815381166fd9
    [root@815381166fd9 /]# ls
    bin  etc   lib    lost+found  mnt  proc  run   srv  tmp  var       volume02
    dev  home  lib64  media       opt  root  sbin  sys  usr  volume01
    [root@815381166fd9 /]# cd volume01/
    [root@815381166fd9 volume01]# ls
    123  12345</p>
<p>```</p>
</li>
<li>
<p>创建docker03, 发现也可以挂载
    <code>bash
    [root@sugarlearn home]# docker run -it --name docker03 --volumes-from docker01 shigang/centos:1.0
    [root@8fbd45b8dd55 /]# ls
    bin  etc   lib    lost+found  mnt  proc  run   srv  tmp  var       volume02
    dev  home  lib64  media       opt  root  sbin  sys  usr  volume01
    [root@8fbd45b8dd55 /]# cd volume0
    bash: cd: volume0: No such file or directory
    [root@8fbd45b8dd55 /]# cd volume01
    [root@8fbd45b8dd55 volume01]# ls
    12038120938  123  12345  aksdjhaskdjh</code></p>
</li>
<li>
<p>将dicker01删除之后, 发现数据依然是存在的, docker02和03的数据卷挂载依然存在</p>
</li>
</ol>
<h3 id="53">5.3. 具名挂载和匿名挂载</h3>
<blockquote>
<p>一般都使用具名挂载, 此概念了解即可</p>
</blockquote>
<p>匿名挂载:</p>
<pre><code class="language-bash">-v 容器内路径
</code></pre>
<h2 id="6-dockerfile">6. dockerfile</h2>
<h3 id="61">6.1. 构建步骤:</h3>
<ol>
<li>编写dockerfile文件</li>
<li><code>docker build</code> 构建成为一个镜像</li>
<li><code>docker run</code> 运行镜像</li>
<li><code>docker push</code> 发布镜像</li>
</ol>
<blockquote>
<p>Tip: 官方名字是Dockerfile, 使用官方名字, 在build的时候就不需要使用<code>-f</code>指定文件了. </p>
</blockquote>
<h3 id="62">6.2. 查看官方例子</h3>
<p>以centos为例: <a href="https://hub.docker.com/_/centos">官方镜像地址</a>
点击具体的版本号进去, 发现是github页面, 里面是dockerfile文件
很多官方的镜像都是基础包, 很多的功能是没有的, 我们通常会搭建自己的镜像
![[Pasted image 20220121043052.png]]
![[Pasted image 20220121043123.png]]</p>
<pre><code class="language-bash">FROM scratch

ADD centos-7-x86_64-docker.tar.xz /

LABEL \

org.label-schema.schema-version=&quot;1.0&quot; \

org.label-schema.name=&quot;CentOS Base Image&quot; \

org.label-schema.vendor=&quot;CentOS&quot; \

org.label-schema.license=&quot;GPLv2&quot; \

org.label-schema.build-date=&quot;20201113&quot; \

org.opencontainers.image.title=&quot;CentOS Base Image&quot; \

org.opencontainers.image.vendor=&quot;CentOS&quot; \

org.opencontainers.image.licenses=&quot;GPL-2.0-only&quot; \

org.opencontainers.image.created=&quot;2020-11-13 00:00:00+00:00&quot;

CMD [&quot;/bin/bash&quot;]
</code></pre>
<h3 id="63-dockerfile">6.3. dockerfile组成</h3>
<p>基础知识:
1. 每个关键字(指令)都必须是大写
2. 从上到下的执行顺序
3. # 表示注释
4. 每个指令都会创建提交一个新的<strong><em>镜像层</em></strong>, 并提交.</p>
<p><img alt="" src="https://img2020.cnblogs.com/blog/1031302/202009/1031302-20200915150122670-1388543274.png" /></p>
<h3 id="64-dockerfile">6.4. dockerfile的指令</h3>
<p>指令汇总:
<img alt="" src="https://img2018.cnblogs.com/i-beta/631711/201912/631711-20191220153130957-348455400.png" /></p>
<pre><code>FROM    # 基础镜像, 一切从这里构建
MAINTAINER # 镜像的作者, 姓名+邮箱
RUN        # 镜像构建的时候
ADD        # 步骤
WORKDIR    # 镜像的工作目录
VOLUME     # 挂载的目录
EXPOSE     # 暴露端口

CMD        # 指定容器启动的时候, 运行的命令, 只有最后一个会生效, 且可被替代
ENTRYPOINT # 指定容器启动的时候, 运行的命令, 可以追加命令

ONBUILD    # 当构建一个被继承的dockerfile的时候, 就会运行 onbuild 的命令. 
COPY       # 类似于add, 将文件拷贝到镜像中

ENV        # 构建的时候设置环境变量
</code></pre>
<h3 id="65-dockerfilecentos">6.5. 使用dockerfile构建自己的centos系统</h3>
<pre><code class="language-bash">FROM scratch    # dockerhub中绝大多数的镜像, 都是从此基础镜像而来的
</code></pre>
<blockquote>
<p>创建自己的centos</p>
</blockquote>
<ol>
<li>编写配置文件</li>
</ol>
<pre><code class="language-bash">FROM centos
MAINTAINER sugar&lt;1144392179@qq.com&gt;

ENV MYPATH /usr/local     
WORKDIR $MYPATH            # 设置工作目录, 即为进入容器内的目录. 官方的centos启动之后, 进入容器内部为根目录, 通过此设置, 可以将进入容器的默认目录进行修改

RUN yum -y install vim
RUN yum -y install net-tools

EXPOSE 80

CMD echo $MYPATH
CMD echo &quot;---end---&quot;
CMD /bin/bash

</code></pre>
<ol>
<li>通过文件构建镜像</li>
</ol>
<pre><code class="language-bash">docker build -f dockfile -t mycentos:0.1 .
</code></pre>
<p>通过上面的命令, 使用 dockerfile构建构建新的镜像</p>
<pre><code class="language-bash">[root@sugarlearn docker-test-volume]# docker build -f dockerfile -t mycentos:0.1 .
Sending build context to Docker daemon 2.048 kB
Step 1/10 : FROM centos
 ---&gt; 5d0da3dc9764
Step 2/10 : MAINTAINER sugar&lt;1144392179@qq.com&gt;
 ---&gt; Running in b6fcc94bb8a5
 ---&gt; 74c30c1cbe48
Removing intermediate container b6fcc94bb8a5
Step 3/10 : ENV MYPATH /usr/local
 ---&gt; Running in 9f870d79569c
 ---&gt; 2c28d28d5fd8
Removing intermediate container 9f870d79569c
Step 4/10 : WORKDIR $MYPATH
 ---&gt; dfb3f984beb8
Removing intermediate container dd41b1c38380
Step 5/10 : RUN yum -y install vim
 ---&gt; Running in b6c7b75645b7

CentOS Linux 8 - AppStream                      4.6 MB/s | 8.4 MB     00:01
CentOS Linux 8 - BaseOS                         4.0 MB/s | 4.6 MB     00:01
CentOS Linux 8 - Extras                          17 kB/s |  10 kB     00:00
Dependencies resolved.
================================================================================
 Package             Arch        Version                   Repository      Size
================================================================================
Installing:
 vim-enhanced        x86_64      2:8.0.1763-16.el8         appstream      1.4 M
Installing dependencies:
 gpm-libs            x86_64      1.20.7-17.el8             appstream       39 k
 vim-common          x86_64      2:8.0.1763-16.el8         appstream      6.3 M
 vim-filesystem      noarch      2:8.0.1763-16.el8         appstream       49 k
 which               x86_64      2.21-16.el8               baseos          49 k

Transaction Summary
================================================================================
Install  5 Packages

Total download size: 7.8 M
Installed size: 30 M
Downloading Packages:
(1/5): gpm-libs-1.20.7-17.el8.x86_64.rpm        221 kB/s |  39 kB     00:00
(2/5): vim-enhanced-8.0.1763-16.el8.x86_64.rpm  4.5 MB/s | 1.4 MB     00:00
(3/5): vim-filesystem-8.0.1763-16.el8.noarch.rp 172 kB/s |  49 kB     00:00
(4/5): which-2.21-16.el8.x86_64.rpm             309 kB/s |  49 kB     00:00
(5/5): vim-common-8.0.1763-16.el8.x86_64.rpm     12 MB/s | 6.3 MB     00:00
--------------------------------------------------------------------------------
Total                                           5.7 MB/s | 7.8 MB     00:01
warning: /var/cache/dnf/appstream-02e86d1c976ab532/packages/gpm-libs-1.20.7-17.el8.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID 8483c65d: NOKEY
CentOS Linux 8 - AppStream                      1.6 MB/s | 1.6 kB     00:00
Importing GPG key 0x8483C65D:
 Userid     : &quot;CentOS (CentOS Official Signing Key) &lt;security@centos.org&gt;&quot;
 Fingerprint: 99DB 70FA E1D7 CE22 7FB6 4882 05B5 55B3 8483 C65D
 From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial
Key imported successfully
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                        1/1
  Installing       : which-2.21-16.el8.x86_64                               1/5
  Installing       : vim-filesystem-2:8.0.1763-16.el8.noarch                2/5
  Installing       : vim-common-2:8.0.1763-16.el8.x86_64                    3/5
  Installing       : gpm-libs-1.20.7-17.el8.x86_64                          4/5
  Running scriptlet: gpm-libs-1.20.7-17.el8.x86_64                          4/5
  Installing       : vim-enhanced-2:8.0.1763-16.el8.x86_64                  5/5
  Running scriptlet: vim-enhanced-2:8.0.1763-16.el8.x86_64                  5/5
  Running scriptlet: vim-common-2:8.0.1763-16.el8.x86_64                    5/5
  Verifying        : gpm-libs-1.20.7-17.el8.x86_64                          1/5
  Verifying        : vim-common-2:8.0.1763-16.el8.x86_64                    2/5
  Verifying        : vim-enhanced-2:8.0.1763-16.el8.x86_64                  3/5
  Verifying        : vim-filesystem-2:8.0.1763-16.el8.noarch                4/5
  Verifying        : which-2.21-16.el8.x86_64                               5/5

Installed:
  gpm-libs-1.20.7-17.el8.x86_64         vim-common-2:8.0.1763-16.el8.x86_64
  vim-enhanced-2:8.0.1763-16.el8.x86_64 vim-filesystem-2:8.0.1763-16.el8.noarch
  which-2.21-16.el8.x86_64

Complete!
 ---&gt; 4c7b4ce9b341
Removing intermediate container b6c7b75645b7
Step 6/10 : RUN yum -y install net-tools
 ---&gt; Running in 44cf17d41b1d

Last metadata expiration check: 0:00:10 ago on Mon Jan 24 09:43:16 2022.
Dependencies resolved.
================================================================================
 Package         Architecture Version                        Repository    Size
================================================================================
Installing:
 net-tools       x86_64       2.0-0.52.20160912git.el8       baseos       322 k

Transaction Summary
================================================================================
Install  1 Package

Total download size: 322 k
Installed size: 942 k
Downloading Packages:
net-tools-2.0-0.52.20160912git.el8.x86_64.rpm   1.2 MB/s | 322 kB     00:00
--------------------------------------------------------------------------------
Total                                           337 kB/s | 322 kB     00:00
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                        1/1
  Installing       : net-tools-2.0-0.52.20160912git.el8.x86_64              1/1
  Running scriptlet: net-tools-2.0-0.52.20160912git.el8.x86_64              1/1
  Verifying        : net-tools-2.0-0.52.20160912git.el8.x86_64              1/1

Installed:
  net-tools-2.0-0.52.20160912git.el8.x86_64

Complete!
 ---&gt; e2a85f441e55
Removing intermediate container 44cf17d41b1d
Step 7/10 : EXPOSE 80
 ---&gt; Running in 96cbdbc3347b
 ---&gt; 135f028da5a8
Removing intermediate container 96cbdbc3347b
Step 8/10 : CMD echo $MYPATH
 ---&gt; Running in 4d092e681f27
 ---&gt; d7877648b301
Removing intermediate container 4d092e681f27
Step 9/10 : CMD echo &quot;---end---&quot;
 ---&gt; Running in 551d9ae06abe
 ---&gt; c465707419b5
Removing intermediate container 551d9ae06abe
Step 10/10 : CMD /bin/bash
 ---&gt; Running in 3ad32c2be5fd
 ---&gt; 6996698dfbc1
Removing intermediate container 3ad32c2be5fd
Successfully built 6996698dfbc1
</code></pre>
<p>. 构建镜像之后, 可以进入容器查看命令是否安装</p>
<pre><code class="language-bash">[root@sugarlearn docker-test-volume]# docker images
REPOSITORY                    TAG                 IMAGE ID            CREATED              SIZE
mycentos                      0.1                 6996698dfbc1        About a minute ago   326 MB
[root@sugarlearn docker-test-volume]# docker run -it mycentos:0.1
[root@b22fae9e9ab5 local]# pwd
/usr/local
[root@b22fae9e9ab5 local]# vim     # 可以发现vim已经安装了
</code></pre>
<h3 id="66">6.6. 列出镜像历史</h3>
<pre><code class="language-bash">[root@sugarlearn docker-test-volume]# docker images
REPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE
mycentos                      0.1                 6996698dfbc1        12 minutes ago      326 MB
[root@sugarlearn docker-test-volume]# docker history 6996698dfbc1
IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT
6996698dfbc1        12 minutes ago      /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;/b...   0 B
c465707419b5        12 minutes ago      /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;ec...   0 B
d7877648b301        12 minutes ago      /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;ec...   0 B
135f028da5a8        12 minutes ago      /bin/sh -c #(nop)  EXPOSE 80/tcp                0 B
e2a85f441e55        12 minutes ago      /bin/sh -c yum -y install net-tools             28.4 MB
4c7b4ce9b341        12 minutes ago      /bin/sh -c yum -y install vim                   66.3 MB
dfb3f984beb8        13 minutes ago      /bin/sh -c #(nop) WORKDIR /usr/local            0 B
2c28d28d5fd8        13 minutes ago      /bin/sh -c #(nop)  ENV MYPATH=/usr/local        0 B
74c30c1cbe48        13 minutes ago      /bin/sh -c #(nop)  MAINTAINER sugar&lt;114439...   0 B
5d0da3dc9764        4 months ago        /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0 B
&lt;missing&gt;           4 months ago        /bin/sh -c #(nop)  LABEL org.label-schema....   0 B
&lt;missing&gt;           4 months ago        /bin/sh -c #(nop) ADD file:805cb5e15fb6e0b...   231 MB
[root@sugarlearn docker-test-volume]#

</code></pre>
<blockquote>
<p>可以查看其他镜像的构建过程</p>
</blockquote>
<pre><code class="language-bash">[root@sugarlearn docker-test-volume]# docker images
REPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE
mycentos                      0.1                 6996698dfbc1        14 minutes ago      326 MB
docker.io/b3log/siyuan        latest              68ac87c0ad39        3 days ago          142 MB
docker.io/jonnyan404/mrdoc    latest              a187113ddd2a        7 days ago          864 MB
docker.io/zmister/mrdoc       v1                  1f0e4ae2440e        2 weeks ago         839 MB
docker.io/nginx               latest              605c77e624dd        3 weeks ago         141 MB
docker.io/tomcat              latest              fb5657adc892        4 weeks ago         680 MB
docker.io/centos              latest              5d0da3dc9764        4 months ago        231 MB
docker.io/jellyfin/jellyfin   latest              0aa773b67433        4 months ago        717 MB
docker.io/elasticsearch       7.6.2               f29a1ee41030        22 months ago       791 MB
[root@sugarlearn docker-test-volume]# docker history 605c77e624dd
IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT
605c77e624dd        3 weeks ago         /bin/sh -c #(nop)  CMD [&quot;nginx&quot; &quot;-g&quot; &quot;daem...   0 B
&lt;missing&gt;           3 weeks ago         /bin/sh -c #(nop)  STOPSIGNAL SIGQUIT           0 B
&lt;missing&gt;           3 weeks ago         /bin/sh -c #(nop)  EXPOSE 80                    0 B
&lt;missing&gt;           3 weeks ago         /bin/sh -c #(nop)  ENTRYPOINT [&quot;/docker-en...   0 B
&lt;missing&gt;           3 weeks ago         /bin/sh -c #(nop) COPY file:09a214a3e07c91...   4.61 kB
&lt;missing&gt;           3 weeks ago         /bin/sh -c #(nop) COPY file:0fd5fca330dcd6...   1.04 kB
&lt;missing&gt;           3 weeks ago         /bin/sh -c #(nop) COPY file:0b866ff3fc1ef5...   1.96 kB
&lt;missing&gt;           3 weeks ago         /bin/sh -c #(nop) COPY file:65504f71f5855c...   1.2 kB
&lt;missing&gt;           3 weeks ago         /bin/sh -c set -x     &amp;&amp; addgroup --system...   61.1 MB
&lt;missing&gt;           3 weeks ago         /bin/sh -c #(nop)  ENV PKG_RELEASE=1~bullseye   0 B
&lt;missing&gt;           3 weeks ago         /bin/sh -c #(nop)  ENV NJS_VERSION=0.7.1        0 B
&lt;missing&gt;           3 weeks ago         /bin/sh -c #(nop)  ENV NGINX_VERSION=1.21.5     0 B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  LABEL maintainer=NGINX ...   0 B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  CMD [&quot;bash&quot;]                 0 B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) ADD file:09675d11695f65c...   80.4 MB
[root@sugarlearn docker-test-volume]#

</code></pre>
<h3 id="67-cmdentrypoint">6.7. CMD和ENTRYPOINT的区别</h3>
<p>dockerfile中一下两个命令的区别</p>
<pre><code class="language-bash">CMD        # 指定容器启动的时候, 运行的命令, 只有最后一个会生效, 且可被替代
ENTRYPOINT # 指定容器启动的时候, 运行的命令, 可以追加命令
</code></pre>
<p><strong>测试cmd</strong>:
可以看到, 启动镜像之后, 直接执行了CMD中的命令, 工作目录的文件列了出来</p>
<p>构建dockerfile用来测试</p>
<pre><code class="language-dockerfile">FROM centos
CMD [&quot;ls&quot;,&quot;-a&quot;]
</code></pre>
<p>构建并启动镜像</p>
<pre><code class="language-bash">[root@sugarlearn docker-test-volume]# docker build -f dockerfile_cmd -t cmdtest:1.0 .
Sending build context to Docker daemon 3.072 kB
Step 1/2 : FROM centos
 ---&gt; 5d0da3dc9764
Step 2/2 : CMD ls -a
 ---&gt; Running in 436ea9052803
 ---&gt; 9da23cd6ea1d
Removing intermediate container 436ea9052803
Successfully built 9da23cd6ea1d
[root@sugarlearn docker-test-volume]# docker images
REPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE
cmdtest                       1.0                 9da23cd6ea1d        5 seconds ago       231 MB
mycentos                      0.1                 6996698dfbc1        17 minutes ago      326 MB
docker.io/b3log/siyuan        latest              68ac87c0ad39        3 days ago          142 MB
docker.io/jonnyan404/mrdoc    latest              a187113ddd2a        7 days ago          864 MB
docker.io/zmister/mrdoc       v1                  1f0e4ae2440e        2 weeks ago         839 MB
docker.io/nginx               latest              605c77e624dd        3 weeks ago         141 MB
docker.io/tomcat              latest              fb5657adc892        4 weeks ago         680 MB
docker.io/centos              latest              5d0da3dc9764        4 months ago        231 MB
docker.io/jellyfin/jellyfin   latest              0aa773b67433        4 months ago        717 MB
docker.io/elasticsearch       7.6.2               f29a1ee41030        22 months ago       791 MB
[root@sugarlearn docker-test-volume]# docker run 9da23cd6ea1d
.
..
.dockerenv
bin
dev
etc
home
lib
lib64
lost+found
media
mnt
opt
proc
root
run
sbin
srv
sys
tmp
usr
var
[root@sugarlearn docker-test-volume]#
</code></pre>
<p>dockerfile中执行的命令为<code>ls -a</code>, 如果想追加命令为<code>ls -al</code>, 测试一下, 发现会报错.
使用CMD的情况下, -l 会替换 CMD中的命令["ls","-a"], 将<code>-l</code>认定为一个命令, 但是找不到此命令, 所以会报错.
如果想要<code>ls -al</code> 则必须输入完整的命令. </p>
<pre><code class="language-bash">[root@sugarlearn docker-test-volume]# docker run 9da23cd6ea1d -l
container_linux.go:235: starting container process caused &quot;exec: \&quot;-l\&quot;: executable file not found in $PATH&quot;
/usr/bin/docker-current: Error response from daemon: oci runtime error: container_linux.go:235: starting container process caused &quot;exec: \&quot;-l\&quot;: executable file not found in $PATH&quot;.
[root@sugarlearn docker-test-volume]# docker run 9da23cd6ea1d ls -al
total 56
drwxr-xr-x   1 root root 4096 Jan 24 10:12 .
drwxr-xr-x   1 root root 4096 Jan 24 10:12 ..
-rwxr-xr-x   1 root root    0 Jan 24 10:12 .dockerenv
lrwxrwxrwx   1 root root    7 Nov  3  2020 bin -&gt; usr/bin
drwxr-xr-x   5 root root  340 Jan 24 10:12 dev
drwxr-xr-x   1 root root 4096 Jan 24 10:12 etc
drwxr-xr-x   2 root root 4096 Nov  3  2020 home
lrwxrwxrwx   1 root root    7 Nov  3  2020 lib -&gt; usr/lib
lrwxrwxrwx   1 root root    9 Nov  3  2020 lib64 -&gt; usr/lib64
drwx------   2 root root 4096 Sep 15 14:17 lost+found
drwxr-xr-x   2 root root 4096 Nov  3  2020 media
drwxr-xr-x   2 root root 4096 Nov  3  2020 mnt
drwxr-xr-x   2 root root 4096 Nov  3  2020 opt
dr-xr-xr-x 148 root root    0 Jan 24 10:12 proc
dr-xr-x---   2 root root 4096 Sep 15 14:17 root
drwxr-xr-x   1 root root 4096 Jan 24 10:12 run
lrwxrwxrwx   1 root root    8 Nov  3  2020 sbin -&gt; usr/sbin
drwxr-xr-x   2 root root 4096 Nov  3  2020 srv
dr-xr-xr-x  13 root root    0 Jan 19 07:39 sys
drwxrwxrwt   7 root root 4096 Sep 15 14:17 tmp
drwxr-xr-x  12 root root 4096 Sep 15 14:17 usr
drwxr-xr-x  20 root root 4096 Sep 15 14:17 var
</code></pre>
<p><strong>测试ENTRYPOINT</strong>
上述使用CMD追加命令的时候, 会将命令替换掉, 但是使用ENTRYPOINT则可以追加命令. 
测试一下. 
首先编写dockerfile</p>
<pre><code class="language-dockerfile">FROM centos
CMD [&quot;ls&quot;,&quot;-a&quot;]
</code></pre>
<p>构建并执行镜像, 可以发现, 追加 <code>-l</code>可以正确的执行命令, 不会覆盖原来的命令</p>
<pre><code class="language-bash">[root@sugarlearn docker-test-volume]# docker run entrypoint
.
..
.dockerenv
bin
dev
etc
home
lib
lib64
lost+found
media
mnt
opt
proc
root
run
sbin
srv
sys
tmp
usr
var
[root@sugarlearn docker-test-volume]# docker run entrypoint -l
total 56
drwxr-xr-x   1 root root 4096 Jan 24 10:15 .
drwxr-xr-x   1 root root 4096 Jan 24 10:15 ..
-rwxr-xr-x   1 root root    0 Jan 24 10:15 .dockerenv
lrwxrwxrwx   1 root root    7 Nov  3  2020 bin -&gt; usr/bin
drwxr-xr-x   5 root root  340 Jan 24 10:15 dev
drwxr-xr-x   1 root root 4096 Jan 24 10:15 etc
drwxr-xr-x   2 root root 4096 Nov  3  2020 home
lrwxrwxrwx   1 root root    7 Nov  3  2020 lib -&gt; usr/lib
lrwxrwxrwx   1 root root    9 Nov  3  2020 lib64 -&gt; usr/lib64
drwx------   2 root root 4096 Sep 15 14:17 lost+found
drwxr-xr-x   2 root root 4096 Nov  3  2020 media
drwxr-xr-x   2 root root 4096 Nov  3  2020 mnt
drwxr-xr-x   2 root root 4096 Nov  3  2020 opt
dr-xr-xr-x 147 root root    0 Jan 24 10:15 proc
dr-xr-x---   2 root root 4096 Sep 15 14:17 root
drwxr-xr-x   1 root root 4096 Jan 24 10:15 run
lrwxrwxrwx   1 root root    8 Nov  3  2020 sbin -&gt; usr/sbin
drwxr-xr-x   2 root root 4096 Nov  3  2020 srv
dr-xr-xr-x  13 root root    0 Jan 19 07:39 sys
drwxrwxrwt   7 root root 4096 Sep 15 14:17 tmp
drwxr-xr-x  12 root root 4096 Sep 15 14:17 usr
drwxr-xr-x  20 root root 4096 Sep 15 14:17 var
</code></pre>
<h2 id="7-reference">7. reference</h2>
<ol>
<li><a href="https://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html">docker使用指南</a></li>
<li><a href="https://www.ruanyifeng.com/blog/2018/02/docker-wordpress-tutorial.html">docker建站</a></li>
<li><a href="https://juejin.cn/post/7021006271818137630?share_token=878fa440-84d9-4d8a-980e-aaba73440daf">求求你了，用Docker吧</a></li>
<li><a href="https://www.bilibili.com/video/BV1og4y1q7M4">狂神说docker视频</a></li>
<li><a href="https://docs.docker.com/get-started/">官方帮助文档</a></li>
</ol>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../learn_bus/I2C/" class="md-footer__link md-footer__link--prev" aria-label="Previous: I2C" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              I2C
            </div>
          </div>
        </a>
      
      
        
        <a href="../docker%E6%90%AD%E5%BB%BA%E6%80%9D%E6%BA%90%E7%AC%94%E8%AE%B0/" class="md-footer__link md-footer__link--next" aria-label="Next: docker实战:思源笔记" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              docker实战:思源笔记
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.748e2769.min.js"></script>
      
    
  </body>
</html>